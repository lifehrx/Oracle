### with 语句用法


```SQL
	WITH wpInfo as
			(SELECT to_char(wp.welding_date,'yyyy-MM-dd') wdate,wp.id,nvl(w.inches_diameter,0) inches_diameter
			,"project".id PROJECT_ID,"device".id DEVICE_ID,"zone".id ZONE_ID
			,"project".project_name,"device".device_name,"zone".zone_name
			FROM TB_SYS_PROJECT "project"
			LEFT JOIN TB_SYS_DEVICE "device" ON "device".PROJECT_ID="project".ID
			LEFT JOIN TB_SYS_ZONE "zone" ON "zone".DEVICE_ID="device".ID
			LEFT JOIN tb_cm_pipeline p ON P.DEVICE_ID="device".ID AND (P.ZONE_ID="zone".ID OR P.ZONE_ID IS NULL)
			LEFT JOIN tb_cm_welding_process wp ON wp.pipeline_id=p.id
			LEFT JOIN tb_cm_weld w on wp.weld_id=w.id
			where (WP.REPAIR_IDENTIFY=0 AND wp.welding_date>=to_date('2021-06-01','yyyy-MM-dd')
			and wp.welding_date<to_date('2021-06-04','yyyy-MM-dd') and wp.is_available='1' OR WP.WELDING_DATE IS NULL)
			AND "project".ID='e78c26c6-ea46-443e-b623-c4ea2950c31d'),

			INCH_INFO AS
			(SELECT * FROM
			(SELECT wdate,inches_diameter,project_id "id",NULL "parent",0 "level",'false' "isLeaf",'true' "expanded"
			,project_name "name"
			FROM  wpInfo WHERE 1=1 AND project_id='e78c26c6-ea46-443e-b623-c4ea2950c31d')
			pivot (sum(inches_diameter) "totalInch" for wdate in('2021-06-01','2021-06-02','2021-06-03','2021-06-04'))
			UNION ALL
			SELECT * FROM
			(SELECT wdate,inches_diameter,device_id "id",project_id "parent",1 "level"
			,case when zone_id is null then 'true' else 'false' end "isLeaf",'true' "expanded"
			,device_name "name"
			FROM  wpInfo WHERE 1=1 AND project_id='e78c26c6-ea46-443e-b623-c4ea2950c31d' AND device_id='')
			pivot (sum(inches_diameter) "totalInch" for wdate in('2021-06-01','2021-06-02','2021-06-03','2021-06-04'))
			UNION ALL
			SELECT * FROM
			(SELECT wdate,inches_diameter,zone_id "id",device_id "parent",2 "level",'true' "isLeaf",'true' "expanded"
			,zone_name "name"
			FROM  wpInfo WHERE 1=1 AND project_id='e78c26c6-ea46-443e-b623-c4ea2950c31d' AND zone_id IS NOT NULL
			AND device_id='' AND zone_id IS NOT NULL AND zone_id='')
			pivot (sum(inches_diameter) "totalInch" for wdate in('2021-06-01','2021-06-02','2021-06-03','2021-06-04')))
			SELECT * FROM INCH_INFO;
```
